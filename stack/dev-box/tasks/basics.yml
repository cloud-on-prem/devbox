- name: Add PPAs
  become: yes
  become_user: root
  apt_repository: repo={{ item.name }} update_cache=yes
  with_items:
    - {name: 'ppa:neovim-ppa/unstable'}
    - {name: 'ppa:pi-rho/dev'}

- name: Upgrade Apt
  become: yes
  become_user: root
  when: force_full_apt_upgrade is defined
  apt: upgrade=full update_cache=yes install_recommends=yes

- name: Install Essentials
  become: yes
  become_user: root
  apt: name={{ item }} state=latest force=yes
  with_items:
    - ntp
    - language-pack-en
    - git
    - build-essential
    - python-dev
    - python3-dev
    - python3-pip
    - default-jre
    - default-jdk
    - cmake
    - automake
    - pkg-config
    - libpcre3-dev
    - zlib1g-dev
    - liblzma-dev
    - ruby-dev
    - libxslt-dev
    - libxml2-dev
    - libffi-dev
    - upower
    - mercurial

- name: Install correct Pip
  become: yes
  become_user: root
  easy_install: name=pip state=latest

- name: Install Python Virtualenv
  become: yes
  become_user: root
  pip: name=virtualenv state=latest

- name: Common Config Files
  template: src=./dev-box/templates/{{ item.src }} dest={{ item.dest }}
  with_items:
    - { src: 'ack.rc'                  , dest: '~/.ackrc' }
    - { src: 'gem.rc'                  , dest: '~/.gemrc' }
    - { src: 'gitconfig.rc'            , dest: '~/.gitconfig' }
    - { src: 'git/gitignore_global.rc' , dest: '~/.gitignore_global' }
    - { src: 'tmux.rc'                 , dest: '~/.tmux.conf' }
    - { src: 'top.rc'                  , dest: '~/.toprc' }
    - { src: 'rspec.rc'                , dest: '~/.rspec' }
    - { src: 'ctags.rc'                , dest: '~/.ctags' }
    - { src: 'ghci.rc'                 , dest: '~/.ghci' }
    - { src: 'haskeline.rc'            , dest: '~/.haskeline' }
    - { src: 'inputrc.bash'            , dest: '~/.inputrc' }

- name: Set up Timezone
  become: yes
  become_user: root
  command: "{{ item }}"
  with_items:
    - sudo timedatectl set-timezone {{ timezone }}
    - ln -sf /usr/share/zoneinfo/{{ timezone }} /etc/localtime
